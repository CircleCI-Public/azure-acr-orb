description: "Build a docker image"

parameters:
  login-server-name:
    type: string
    description: >
      The Azure login server for your ACR instance,
      e.g. {yourregistryname}.azure.io

  repo:
    type: string
    description: Name of an ACR repository

  tag:
    type: string
    description: A docker image tag (default = latest)
    default: "latest"

  dockerfile:
    description: Name of dockerfile to use. Defaults to Dockerfile.
    type: string
    default: Dockerfile

  path:
    type: string
    description: >
      Path to the directory containing your Dockerfile and build context.
      Defaults to . (working directory).
    default: .

  extra-build-args:
    type: string
    description: >
      Extra flags to pass to docker build. For examples, see
      https://docs.docker.com/engine/reference/commandline/build
    default: ""

steps:
  - run:
      name: Build docker image
      command: |
        docker build \
          <<#parameters.extra-build-args>><<parameters.extra-build-args>><</parameters.extra-build-args>> \
          -f << parameters.dockerfile >> \
          -t << parameters.login-server-name >>/<< parameters.repo >>:<< parameters.tag >> \
          << parameters.path >>
